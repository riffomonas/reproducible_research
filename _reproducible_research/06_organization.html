---
layout: presentation
title: Organization
permalink: /organization/
---
class: middle center

# {{ page.title }}

.footnote.left.title[{{site.url}}{{site.baseurl}}{{page.permalink}}]
.footnote.left.gray[Press 'h' to open the help menu for interacting with the slides]

---

## Learning goals

* Evaluate different organizational strategies for their ability to foster reproducibility
* Apply `bash` commands to fix a chaotic project so it has a more logical structure
* Interface with a project template to improve the reproducibility of your research
* Apply material from the documentation and organization tutorials to start a new project
* Demonstrate how to use git and GitHub to make your new project public

---

## Before we go any further...

You need to read: [Noble 2009 *PLoS Comp Biol*](http://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1000424)

---

## Noble paper on file organization

* Discusses far more than organization
* Project organization is a form of documentation and helps make written and scripted documentation easier to maintain
* Provides an outline for the rest of these tutorials
  * Organization
  * Literate programming
  * Scripting
  * Automation
  * Version control

.footnote[[Noble 2009 *PLoS Comp Biol*](http://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1000424)]
---

.center[![:scale Noble Figure 1, 75%]({{ site.baseurl }}/assets/images/noble-figure-1.png)]

> The core guiding principle is simple: Someone unfamiliar with your project should be able to look at your computer files and understand in detail what you did and why ... Most commonly, however, that "someone" is you.

.footnote[[Noble 2009 *PLoS Comp Biol*](http://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1000424)]
---

## Refresher on documentation from Noble

* "Record every operation that you perform"
* "Comment generously"
* "~~Avoid~~[DO NOT] editing intermediate files by hand"
* Use a driver script to centralize all processing and analysis
* "Use relative pathways [relative to the project root]"
* "Make the script restartable"

.footnote[[Noble 2009 *PLoS Comp Biol*](http://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1000424)]
---

## Compare file organization from two projects

* Examples
	* [Meadow et al. *Microbiome* study](https://github.com/jfmeadow/Meadow_etal_Surfaces/)
	* [Westcott & Schloss *mSphere* study](https://github.com/SchlossLab/Westcott_OptiClust_mSphere_2017/)
* Questions
	* What do you notice about the structure of the two projects?
  * How long did it take to find the code for Figure 1?
  * Where is the main document?
	* Where would the data go?

---

## An aside about large files

* GitHub cannot easily handle large datasets
* Each file is limited to 100 MB and a repository is limited to 1 GB
* Generally only post the data files critical to an analysis
* Scripts should document where data goes and how it gets there
* We'll talk more about git/GitHub later

---

## General structure for a microbiome study

```
project
|- README.md        # the top level description of content (this doc)
|- CONTRIBUTING.md  # instructions for how to contribute to your project
|- LICENSE.md       # the license for this project
|- CITATION.md      # instructions on how to cite the project
|
|- submission/
| |- study.Rmd      # executable Rmarkdown for this study, if applicable
| |- study.md       # Markdown (GitHub) version of the *.Rmd file
| |- study.tex      # TeX version of *.Rmd file
| |- study.pdf      # PDF version of *.Rmd file
| |- header.tex     # LaTeX header file to format pdf version of manuscript
| |- references.bib # BibTeX formatted references
| |- XXXX.csl       # csl file to format references for journal XXX
|
|- data             # raw and primary data, are not changed once created
| |- references/    # reference files to be used in analysis
| |- raw/           # raw data, will not be altered
| |- mothur/        # mothur processed data
| +- process/       # cleaned data, will not be altered once created;
|                   # will be committed to repo
|
|- code/            # any code
|
|- results          # all output from workflows and analyses
| |- tables/        # text version of tables to be rendered with kable in R
| |- figures/       # graphs, likely designated for manuscript figures
| +- pictures/      # diagrams, images, and other non-graph graphics
|
|- exploratory/     # exploratory data analysis for study
| |- notebook/      # preliminary analyses
| +- scratch/       # temporary files that can be safely deleted or lost
|
+- Makefile         # executable Makefile for this study, if applicable
```

???

* You are free to do what you want, but keep to the basic priniciples outlined in the Noble paper
* You'll see this again when we discuss the `new_project` repository

---

## Bad project: Introduction

.center[
<iframe width="570" height="320" src="https://www.youtube.com/embed/Fl4L4M8m4d0?ecver=1" frameborder="0" allowfullscreen></iframe>
]

* You have inherited a project from a previous student in the lab
* You need to organize it into a logical structure

---

## Bad project: Exercise

* Download the [data](https://github.com/riffomonas/bad_project/archive/v0.1.zip) to a new directory `~/bad_project`

```{bash}
wget https://github.com/riffomonas/bad_project/archive/v0.1.zip
unzip v0.1.zip
rm v0.1.zip
mv bad_project-0.1 bad_project
cd bad_project
```

* Using the recommended directory structure, move files to the appropriate directories
	* Use `mkdir new_directory` to create a new directory
  * Use `mv current_file directory/` to move `current_file` into `directory/`
  * Don't forget the `/` after `directory`

.footnote[Now would be a good time to [log into](../hpc/) your AWS instance or your local HPC]

---

## General structure for a microbiome study

```
project
|- README.md        # the top level description of content (this doc)
|- CONTRIBUTING.md  # instructions for how to contribute to your project
|- LICENSE.md       # the license for this project
|- CITATION.md      # instructions on how to cite the project
|
|- submission/
| |- study.Rmd      # executable Rmarkdown for this study, if applicable
| |- study.md       # Markdown (GitHub) version of the *.Rmd file
| |- study.tex      # TeX version of *.Rmd file
| |- study.pdf      # PDF version of *.Rmd file
| |- header.tex     # LaTeX header file to format pdf version of manuscript
| |- references.bib # BibTeX formatted references
| |- XXXX.csl       # csl file to format references for journal XXX
|
|- data             # raw and primary data, are not changed once created
| |- references/    # reference files to be used in analysis
| |- raw/           # raw data, will not be altered
| |- mothur/        # mothur processed data
| +- process/       # cleaned data, will not be altered once created;
|                   # will be committed to repo
|
|- code/            # any code
|
|- results          # all output from workflows and analyses
| |- tables/        # text version of tables to be rendered with kable in R
| |- figures/       # graphs, likely designated for manuscript figures
| +- pictures/      # diagrams, images, and other non-graph graphics
|
|- exploratory/     # exploratory data analysis for study
| |- notebook/      # preliminary analyses
| +- scratch/       # temporary files that can be safely deleted or lost
|
+- Makefile         # executable Makefile for this study, if applicable
```

---

## Bad project: Evaluation

* Compare your results to your neighbor
* Once you are done, run `cat .solution` to see my results
* What do you notice? Do you agree with my organization?

---

## Using a project template

* The structure of most microbiome analysis projects is fairly standard
* To help with the structure, we created a template, [`new_project`](https://github.com/SchlossLab/new_project/releases/latest)
* Return to y our home (~/) directory
* Download the zip file for the latest release of `new_project`

---

## Exercise

.left-column[
* We are going to attempt to generate the paragraph and NMDS plot from [Figure 4](http://aem.asm.org/content/79/17/5112.full) of the Kozich AEM study
* Rename the directory `Kozich_ReAnalysis_AEM_2013`
* We'll set up the project by following along with the instructions in the [`INSTRUCTIONS`](https://github.com/SchlossLab/new_project/blob/master/INSTRUCTIONS.md) file
]

.right-column[
.center[![:scale Mouse analysis section, 70%]({{ site.baseurl }}/assets/images/kozich-figure-4.png)
]]

---

## Modify README.md

* Open the README.md document in `nano`
* Remove the first line, which starts "Download... "
* Edit the following lines as you see appropriate:
```sh
## TITLE OF YOUR PAPER GOES HERE
YOUR PAPER'S ABSTRACT GOES HERE
```
* We'll leave the rest as it is for now

---

## Changing Filenames

* At the terminal do the following...
```bash
mv newproject_LICENSE.md LICENSE.md
```
* This replaces the license ([CC0](https://creativecommons.org/share-your-work/public-domain/cc0/)) of the `new_project` repository with a license for your analysis ([MIT](https://en.wikipedia.org/wiki/MIT_License))
* Using `nano`, go ahead and read and edit the license to include your name and the year (no need to keep my name unless you are in my lab)

???

* Go ahead and read and edit the license to include your name and the year
* Note that the MIT license is a permissive license that allows anyone to use your code. This is generally viewed a A Good Thing.
* It would be worth talking with your research group and PI about what license you want to use.
* Don't think you'll be making money off this repository :)
---

## Getting ready for `git`

* At the terminal do the following:

```bash
git init ./
git add .
git commit -m "Initial commit"
```

* This is putting your new project under version control using `git`

---

## Connecting with GitHub

* Go to your home page on GitHub
* Create a new repository as you did before with the paper airplane example
* This time...
  * Give the repository the same name as your project (i.e. `Kozich_ReAnalysis_AEM_2013`).
  * Keep the repository public
  * Don't initialize with a `README` or `.gitignore` files or a license (you've already got those)
  * Click "Create Repository"

---

class: center middle

![Creating a new repository on GitHub]({{ site.baseurl }}/assets/images/github-new-repository-instructions.png)

???

Click on HTTPS

---

## Connecting with GitHub

* Copy and paste into the terminal the two lines that were highlighted with the red arrow on the previous slide

```bash
Kozich_ReAnalysis_AEM_2013 $ git remote add origin
https://github.com/pschloss/Kozich_ReAnalysis_AEM_2013.git
Kozich_ReAnalysis_AEM_2013 $ git push -u origin master
Counting objects: 26, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (24/24), done.
Writing objects: 100% (26/26), 43.09 KiB | 0 bytes/s, done.
Total 26 (delta 2), reused 0 (delta 0)
remote: Resolving deltas: 100% (2/2), done.
To github.com:pschloss/Kozich_ReAnalysis_AEM_2013.git
 * [new branch]      master -> master
Branch master set up to track remote branch master from origin.
```

* Back in the browser, refresh the screen

---

class: center middle

![New Kozich_ReAnalysis_AEM_2013 repository as shown on GitHub ]({{ site.baseurl }}/assets/images/github-Kozich_ReAnalysis_AEM_2013-repository.png)

---

class: center middle

![Well done - you deserve a high five]({{ site.baseurl }}/assets/images/high-five.gif)

---

## Cleaning up

* Remove the instructions file and commit

```bash
git rm INSTRUCTIONS.md
git commit -m "Remove instructions document"
git push
```

* Refresh your GitHub page and make sure the `INSTRUCTIONS.md` file goes away
* If you ever need the information in the `INSTRUCTIONS.md` file, you can retreive it from the `new_project` [repository](https://github.com/SchlossLab/new_project/blob/master/INSTRUCTIONS.md)

---

## Let's go!

* You need...
  * A partner (preferably someone with mothur experience)
  * Familiarity with [the original paper](http://aem.asm.org/content/79/17/5112.full)
  * The data (hint: grab the data from the "With genomes/metagenomes" link)
  * The reference files
  * mothur
  * Dump the text for the figure lengend and the paragraph titled, "Scaling up", in the main REAME.md
* Obtain the files and put them in the correct locations
* Do your best to document what you are doing

???

* Learners should be able to download these materials based on what is described in the paper

---

## Helpers

* `wget` - pulls down large data files to the current directory (or `curl -LO`)
* `tar xvf` - unpacks a `.tar` file
* `tar xvzf` - unpacks a `.tar.gz` or `.tgz` file
* `rm` - removes files
* In a mardown file you can have text rendered as code by putting the code inside of two sets of three back ticks

```
```
code/mothur/mothur -v
``````

On GitHub, this will be rendered as...

```bash
code/mothur/mothur -v
```
---

## When you're done...

* .alert[Wait!]  Do not commit or push your changes
* Add me/your PI as a collaborator
  * "Settings" -> "Collaborators" -> Enter handle -> "Add collaborator"
  * I'm at `pschloss`

---

`data/code/README.md`

```bash
# README

Obtained the Linux version of mothur (v1.39.5) from the mothur GitHub repository

```bash
wget --no-check-certificate https://github.com/mothur/mothur/releases/download/v1.39.5/Mothur.linux_64.zip
unzip Mothur.linux_64.zip
mv mothur code/
rm Mothur.linux_64.zip
rm -rf __MACOSX
``````

```
mothur should output the version by doing...

```bash
code/mothur/mothur -v
``````

---

`data/raw/README.md`

```bash
# README


Obtained the raw `fastq.gz` files from https://www.mothur.org/MiSeqDevelopmentData.html
* Downloaded https://www.mothur.org/MiSeqDevelopmentData/StabilityWMetaG.tar
* Ran the following from the project's root directory

```bash
wget --no-check-certificate https://www.mothur.org/MiSeqDevelopmentData/StabilityWMetaG.tar
tar xvf StabilityWMetaG.tar -C data/raw/
rm StabilityWMetaG.tar
``````

---

`data/references/README.md`

```bash
# README

Obtained the silva reference alignment from the mothur website:

```bash
wget http://mothur.org/w/images/1/15/Silva.seed_v123.tgz
tar xvzf Silva.seed_v123.tgz silva.seed_v123.align silva.seed_v123.tax
code/mothur/mothur "#get.lineage(fasta=silva.seed_v123.align, taxonomy=silva.seed_v123.tax, taxon=Bacteria);degap.seqs(fasta=silva.seed_v123.pick.align, processors=8)"
mv silva.seed_v123.pick.align data/references/silva.seed.align
rm Silva.seed_v123.tgz silva.seed_v123.*
rm mothur.*.logfile
``````
```
Obtained the RDP reference taxonomy from the mothur website:

```bash
wget -N http://www.mothur.org/w/images/8/88/Trainset14_032015.pds.tgz
tar xvzf Trainset14_032015.pds.tgz
mv trainset14_032015.pds/trainset* data/references/
rm -rf trainset14_032015.pds
rm Trainset14_032015.pds.tgz
``````

---

`README.md`

```bash
## Re-analysis of Kozich dataset

**Scaling up.** The advantage of the dual-index approach is that a large number of samples
can be sequenced using a number of primers equal to only twice the square root of the
number of samples. To fully evaluate this approach, we resequenced the V4 region of 360
samples that were previously described by sequencing the distal end of the V35 region on
the 454 GS-FLX Titanium platform (18). In that study, we observed a clear separation
between murine fecal samples obtained from 8 C57BL/6 mice at 0 to 9 (early) and 141 to 150
(late) days after weaning, and there was significantly less variation between the late
samples than the early samples. In addition to the mouse fecal samples, we allocated 2
pairs of indices to resequence our mock community. We generated 4.3 million pairs of
sequence reads from the 16S rRNA gene with an average coverage of 9,913 pairs of reads per
sample (95% of the samples had more than 2,454 pairs of sequences) using a new collection
of 8-nt indices (see the supplemental material). Although individual samples were expected
to have various amplification efficiencies, analysis of the number of reads per index did
not suggest a systematic positive or negative amplification bias that could be attributed
to the indices. The combined error rate for the two mock communities was 0.07% before
preclustering and 0.01% after (n = 14,094 sequences). When we used UCHIME to remove
chimeras and rarefied to 5,000 sequences, there was an average of 30.4 OTUs (i.e., 10.4
spurious OTUs). Similar to our previous results, ordination of the mouse fecal samples
again showed the separation between the early and late periods and increased stabilization
with age (Fig. 4) (Mantel test coefficient, 0.81; P < 0.001). These results clearly
indicate that our approach can be scaled to multiplex large numbers of samples.

### Overview

	project
	|- README          # the top level description of content (this doc)
<snip>
```

---

## Write the command line code that does the following...

* Creates a new directory called `my_awesome_directory`
* Move from your home directory to the `my_awesome_directory` directory
* Create a new git repository
* Get data from a internet-based resource
* Move a file from one directory to another
* Rename a file
* Decompresses a file ending in zip? tar.gz? tar?

???

* mkdir my_awesome_directory
* cd ~/my_awesome_directory
* git init .
* wget --no-check-certificate https://github.com/mothur/mothur/releases/download/v1.39.5/Mothur.linux_64.zip
* mv current_file new_directory/
* mv newproject_LICENSE.md LICENSE.md
* unzip v0.1.zip; tar xvzf Trainset14_032015.pds.tgz; tar xvf StabilityWMetaG.tar -C data/raw/
